@main("SimMapEditor") {
    <script type="application/javascript">
            $(document).ready( function() {
                var baseMap = L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    noWrap:true
                });
                var baseMap_de = L.tileLayer('http://{s}.tile.openstreetmap.de/tiles/osmde/{z}/{x}/{y}.png', {
                    noWrap:true
                })
                var OpenStreetMap_BlackAndWhite = L.tileLayer('http://{s}.tiles.wmflabs.org/bw-mapnik/{z}/{x}/{y}.png', {
                    noWrap:true
                });
                var MapBox = L.tileLayer('http://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
                    subdomains: 'abcd',
                    id: 'mapbox.streets-basic',
                    accessToken: 'pk.eyJ1IjoiZjNrZWxsZXIiLCJhIjoiY2lsa3VyNjB3MDA3am5ja3FxNHFld3E2NiJ9.A99UzeLIycU2I8jRCPixgg',
                    noWrap:true
                });
                var MapBoxLight = L.tileLayer('http://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
                    subdomains: 'abcd',
                    id: 'mapbox.light',
                    accessToken: 'pk.eyJ1IjoiZjNrZWxsZXIiLCJhIjoiY2lsa3VyNjB3MDA3am5ja3FxNHFld3E2NiJ9.A99UzeLIycU2I8jRCPixgg',
                    noWrap:true
                });
                var SenozonLight = L.tileLayer('http://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
                    subdomains: 'abcd',
                    id: 'firehollaender.b2cc84a4',
                    accessToken: 'pk.eyJ1IjoiZmlyZWhvbGxhZW5kZXIiLCJhIjoiY2lsdzlmamExMDA5dXY5bTQ2bWl2MTZoNCJ9.Q8uzzgMdko8ZbcA6Kbwzlw',
                    noWrap:true
                });

                var map = new L.Map("map", {center: [46.83, 8.3], zoom: 8, layers: [SenozonLight],
                    attributionControl: false,minZoom: 3, maxZoom: 18, noWrap: true , zoomControl: false, maxBounds: [[-180, -180],[180,180]]});
                map.on("click", function(){
                    var streetDetails=$("#streetDetails");
                    var scope = angular.element(streetDetails).scope();
                    scope.updateFeature(null, null, null, map);
                    $(".street-active").removeClass("street-active");
                });
                var svg = d3.select(map.getPanes().overlayPane).append("svg"),
                        g = svg.append("g").attr("class", "leaflet-zoom-hide");

                var addGeoJsonTileLayer = function() {
                    var geojsonURL = 'http://152.96.56.47:40005/api/quadtile/1/{z}/{x}/{y}';
                    //var geojsonURL = 'http://localhost:9001/api/quadtile/1/{z}/{x}/{y}';
                    var geojsonTileLayer = new L.TileLayer.GeoJSON(geojsonURL,{
                        clipTiles: false,
                        identified: function(feature){
                            return feature.properties.id;
                        },
                        unique: function (feature) {
                            return feature.properties.zoomlevel;
                        },
                        modified: function (feature) {
                            var storageHandler = new StorageHandler();
                            var changeset = storageHandler.getLocalChangeset();
                            var geoJson = changeset.geoJson;
                            for (var changedFeature in geoJson.features) {
                                if (geoJson.features[changedFeature].properties.id === feature.properties.id) {
                                    return geoJson.features[changedFeature];
                                }
                            }
                            return feature;
                        }
                    },{
                        onEachFeature: onEachFeature
                    });
                    addOverLay(geojsonTileLayer, "Test Layer");
                };

                var baseLayers = { "Color": baseMap, "Color_DE": baseMap_de,
                    "Black and White": OpenStreetMap_BlackAndWhite, "MapBox": MapBox, "MapBoxLight": MapBoxLight, "SenozonLight": SenozonLight};

                var basicControl = L.control.layers(baseLayers, {}).addTo(map);
                L.control.attribution(null);
                map.addControl(new L.Control.Zoomslider( {position: "bottomright"} ));
                L.control.scale( {position: "bottomleft", imperial: false} ).addTo(map);


                function onEachFeature(feature, layer){
                    if (feature.properties) {
                        layer.setStyle({color: "#6f98a4",opacity: 0.9 , className: "street street_"+feature.properties.zoomlevel});
                        layer.on("click", function(e){
                            $(".street-active").removeClass("street-active");
                            var path = e.target;
                            var container = path._container;
                            $('> path', container).addClass('street-active');
                            var streetDetails = $("#streetDetails");
                            var scope = angular.element(streetDetails).scope();
                            scope.updateFeature(feature, layer, e.latlng, map);
                        });
                    }
                }

                function addOverLay(layer, name) {
                    map.addLayer(layer);
                    basicControl.addOverlay(layer, name);
                }


                var changesetHandler = new ChangesetHandler();
                changesetHandler.initializeChangeset();
                addGeoJsonTileLayer();

                /*var storageHandler = new StorageHandler();

                if (!storageHandler.localChangeSetExists()) {
                    var changesetURL = "http://localhost:9001/api/changesets/1";
                    //var changesetURL = "http://152.96.56.47:40005/api/changesets/1";
                    L.Util.ajax(changesetURL).then(function(data) {
                        var storageHandler = new StorageHandler();
                        try {
                            storageHandler.setLocalChangeset(data);
                            addGeoJsonTileLayer();
                        } catch(e) {
                            console.log(e);
                        }
                    });
                } else {
                    addGeoJsonTileLayer();
                }*/


                /*
                L.easyButton({ position:"topright",states:[{onClick: function(btn, map){
                    $("#importMenu").offcanvas("show");
                },icon:'glyphicon-import'}]}).addTo(map);

                L.easyButton({ position:"topright",states:[{onClick: function(btn, map){
                    map.setView(new L.LatLng(-33.5, -70.6), 10);
                },icon:'glyphicon-screenshot'}]}).addTo(map);
                */

                $(".navbar-toggler").on("click", function(){
                    $("#hiddenMenu").offcanvas("toggle");
                });
            });
    </script>
}
<div id="mapContainer" class="container-fluid">
    <div class="row">
        <div id="map" class="col-xs-12">

        </div>
        <nav id="navmenuLeft" class="navbar navbar-fixed-left navbar-minimal animate" role="navigation">
            <div class="navbar-toggler animate">
                <span class="menu-icon"></span>
            </div>
            <ul class="navbar-menu animate">
                <li>
                    <a id="saveButton" href="#save">
                        <span class="glyphicon glyphicon-floppy-disk" data-toggle="tooltip" data-placement="right" title="Tooltip on right"></span>
                        <span class="badge badge-count">3</span>
                        <span class="infoBubble">3</span>
                    </a>

                </li>
                <li>
                    <a href="#blog">
                        <span class="glyphicon glyphicon-info-sign"></span>
                    </a>
                </li>
                <li>
                    <a href="#contact-us">
                        <span class="glyphicon glyphicon-comment"></span>
                    </a>
                </li>
            </ul>
        </nav>
        <div id="hiddenMenu" class="col-xs-3 nopadding navmenu-fixed-left offcanvas offcanvas-container" ng-controller="StreetMenuController" data-canvas="#hiddenMenu,.leaflet-left, #navmenuLeft">
            <rootMenu ng-show="menuState=='rootMenu'"></rootMenu>
            <loadChangesetMenu ng-show="menuState=='loadChangeset'"></loadChangesetMenu>
        </div>
        <div id="importMenu" class="col-xs-3 navmenu-fixed-right offcanvas offcanvas-container" data-canvas="#importMenu, .leaflet-right">
            <div class="panel panel-default">
                <div class="panel-heading">XML Import</div>
                <div class="panel-body">
                    <form action="http://152.96.56.47:40005/api/xml" method="post" enctype="multipart/form-data">
                        <!--<form action="http://localhost:9001/api/xml" method="post" enctype="multipart/form-data">-->
                        <p>
                                    Network name : <input type="text" name="name">
                                </p>
                        <p>
                                    Choose a file : <input type="file" name="file" />
                                </p>
                        <p>
                                    Choose a format :
                            <select name="format">
                                <option value="WGS84">WGS84</option>
                                <option value="EPSG:3857">EPSG:3857</option>
                                <option value="EPSG:21781">EPSG:21781</option>
                                <option value="EPSG:26914">EPSG:26914</option>
                                <option value="EPSG:32719">EPSG:32719</option>
                            </select>
                        </p>
                        <input type="submit" value="Upload" />
                    </form>
                </div>
            </div>
        </div>
        <div id="streetDetails" class="col-xs-3 navmenu-fixed-right offcanvas offcanvas-container" data-canvas="#streetDetails, .leaflet-right" ng-controller="StreetDetailController">
            <div class="from-header">
                    Strasse bearbeiten
            </div>
            <div class="form-border">
                <div class="form-field-group">
                    <label class="form-label">ID</label>
                    <p class="form-text-uneditable">{{streetModel.properties.id}}</p>
                </div>
                <div class="form-field-group">
                    <label class="form-label">Oneway</label>
                    <select class="form-control form-select-editable" ng-change="changeModel()" ng-model="streetModel.properties.oneway" ng-options="o.v as o.n for o in [{ n: 'false', v: false }, { n: 'true', v: true }]">
                    </select>
                </div>
                <div class="form-field-group">
                    <label class="form-label">Modes</label>
                    <input type="text" step="any" id="input-oneway" class="form-text-editable" ng-change="changeModel()" ng-model="streetModel.properties.modes">
                </div>
                <div class="form-field-group">
                    <label class="form-label">Length (meter)</label>
                    <input type="number" step="any" id="input-oneway" class="form-text-editable" ng-change="changeModel()" ng-model="streetModel.properties.length">
                </div>
                <div class="form-field-group">
                    <label class="form-label">Freespeed (km/h)</label>
                    <input type="number" id="input-oneway" class="form-text-editable" ng-change="changeModel()" ng-model="streetModel.properties.freespeedCalculated">
                </div>
                <div class="form-field-group">
                    <label class="form-label">Permlanes</label>
                    <input type="number" id="input-oneway" class="form-text-editable" ng-change="changeModel()" ng-model="streetModel.properties.permlanes">
                </div>
                <div class="form-field-group">
                    <label class="form-label">Capacity</label>
                    <input type="number" id="input-oneway" class="form-text-editable" ng-change="changeModel()" ng-model="streetModel.properties.capacity">
                </div>
            </div>
        </div>
    </div>
</div>